{% load i18n %}

{% if payment_info %}
    <dl class="dl-horizontal">
        {% if payment_info.transaction_id %}
            <dt>{% trans "Transaction ID" %}</dt>
            <dd>
                {% if dashboard_url %}
                    <a href="{{ dashboard_url }}" target="_blank" rel="noopener noreferrer">
                        {{ payment_info.transaction_id }}
                    </a>
                {% else %}
                    {{ payment_info.transaction_id }}
                {% endif %}
            </dd>
        {% endif %}

        {% if payment_info.state %}
            <dt>{% trans "State" %}</dt>
            <dd>{{ payment_info.state }}</dd>
        {% endif %}

        {% if payment_info.payment_method %}
            <dt>{% trans "Payment Method" %}</dt>
            <dd>{{ payment_info.payment_method }}</dd>
        {% endif %}

        {% if payment_info.error %}
            <dt style="color: #c00;">{% trans "Error" %}</dt>
            <dd style="color: #c00;">
                {{ payment_info.error }}
                {% if payment_info.error_code %} | Code: {{ payment_info.error_code }}{% endif %}
                {% if payment_info.error_status_code %} | HTTP {{ payment_info.error_status_code }}{% endif %}
            </dd>
        {% endif %}

        {% if error_suggestion %}
            <dt></dt>
            <dd><em style="color: #666;">{{ error_suggestion }}</em></dd>
        {% endif %}
    </dl>

    {% if can_capture %}
        <form action="{{ capture_url }}" method="POST" style="margin-top: 10px;">
            {% csrf_token %}
            <button type="submit" class="btn btn-primary btn-sm">
                {% trans "Capture Payment" %}
            </button>
        </form>
    {% endif %}
{% endif %}

{% if has_installments %}
    <div style="margin-top: 20px;">
        <h4>{% trans "Installment Schedule" %}</h4>
        <table class="table table-condensed">
            <thead>
                <tr>
                    <th>{% trans "Installment" %}</th>
                    <th>{% trans "Amount" %}</th>
                    <th>{% trans "Due Date" %}</th>
                    <th>{% trans "Status" %}</th>
                    <th>{% trans "Paid At" %}</th>
                    <th>{% trans "Token ID" %}</th>
                </tr>
            </thead>
            <tbody>
                {% for installment in installment_schedule %}
                    <tr>
                        <td>{{ installment.installment_number }}</td>
                        <td>{{ installment.amount }}</td>
                        <td>{{ installment.due_date }}</td>
                        <td>
                            {% if installment.status == "paid" %}
                                <span style="color: green;">
                                    <strong>{% trans "Paid" %}</strong>
                                </span>
                            {% elif installment.status == "scheduled" %}
                                <span style="color: #f89406;">
                                    <strong>{% trans "Scheduled" %}</strong>
                                </span>
                            {% elif installment.status == "failed" %}
                                <span style="color: red;">
                                    <strong>{% trans "Failed" %}</strong>
                                </span>
                                {% if installment.failure_reason %}
                                    <br><small>{{ installment.failure_reason }}</small>
                                {% endif %}
                            {% elif installment.status == "cancelled" %}
                                <span style="color: #666;">
                                    <strong>{% trans "Cancelled" %}</strong>
                                </span>
                            {% else %}
                                <span>{{ installment.status }}</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if installment.paid_at %}
                                {{ installment.paid_at }}
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td>
                            {% if installment.token_id %}
                                {{ installment.token_id|slice:":6" }}...
                            {% else %}
                                -
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endif %}
